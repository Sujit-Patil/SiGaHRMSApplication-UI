<div class="row">
  <ul ngbNav #nav="ngbNav" [(activeId)]="active" class="nav-tabs">
    <li [ngbNavItem]="1">
      <button ngbNavLink (click)="activeSection = 'leave'">Today's Leaves</button>
    </li>
    <li [ngbNavItem]="2">
      <button ngbNavLink (click)="activeSection = 'leavebalance'">Leave Balance</button>
    </li>
  </ul>
  <ng-template ngbNavContent [ngIf]="activeSection == 'leave'">
    <div class="col-md-12 col-xl-8" style="width: 100%">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div></div>
        <div class="d-flex gap-2 align-items-end">
          <div>
            <input type="date" class="form-control" [(ngModel)]="from" name="dp" />
          </div>

          <div>
            <input type="date" class="form-control" [(ngModel)]="to" [min]="from" name="kp" />
          </div>

          <div class="">
            <button class="btn btn-md btn-primary" (click)="loadLeaveRequests()">Get Leaves</button>
          </div>
        </div>

        <div *ngIf="currentUser.role != userRole.SUPER_ADMIN">
          <button class="btn btn-primary" (click)="newLeaveRequest()">New Request</button>
        </div>
      </div>
      <div class="card tbl-card">
        <div class="card-body">
          <div *ngIf="!leaveRequests; else leaveRequestsTable" class="text-center"> No leave requests found. </div>
          <ng-template #leaveRequestsTable>
            <div class="table-responsive">
              <table class="table table-hover table-borderless mb-0">
                <thead>
                  <tr class="text-center">
                    <th></th>
                    <th>Name</th>
                    <th>Apply Date</th>
                    <th>Leave Type</th>
                    <th>Form Date</th>
                    <th>To Date</th>
                    <th>Leave Length</th>
                    <th>Status</th>
                    <th>Leave Reason</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="text-center" *ngFor="let Request of leaveRequests">
                    <td>
                      <div class="flex-shrink-0">
                        <img src="assets/images/user/avatar-2.jpg" alt="user-image" class="user-avtar wid-35" />
                      </div>
                    </td>
                    <td>{{ Request.Employee.FirstName }} {{ Request.Employee.LastName }}</td>
                    <td>{{ Request.CreatedDateTime | date }}</td>
                    <td>{{ Request.LeaveType }}</td>
                    <td>{{ Request.FromDate | date }}</td>
                    <td>{{ Request.ToDate | date }}</td>
                    <td>{{ Request.IsHalfDay }}</td>

                    <td>
                      <span
                        ><i
                          class="ti ti-circle-check {{
                            Request.LeaveRequestStatus == leaveRequestStatus.Rejected ? 'text-danger' : 'text-success'
                          }} m-r-5"
                        ></i
                        >{{ Request.LeaveRequestStatus }}</span
                      >
                    </td>
                    <td
                      ><a class="btn btn-outline-primary" (click)="showReason(Request.Reason)"><i class="ti ti-message"></i></a
                    ></td>
                    <td>
                      <span *ngIf="currentUser.role == userRole.SUPER_ADMIN && Request.LeaveRequestStatus == leaveRequestStatus.Open">
                        <a
                          class="btn btn-outline-primary"
                          (click)="Request.LeaveRequestStatus = leaveRequestStatus.Approved; approve(Request)"
                          ><i class="ti ti-checks"></i
                        ></a>
                        <a
                          class="btn btn-outline-danger m-2"
                          (click)="Request.LeaveRequestStatus = leaveRequestStatus.Rejected; reject(Request)"
                          ><i class="ti ti-x"></i
                        ></a>
                      </span>
                      <span *ngIf="currentUser.employeeId == Request.EmployeeId && today <= Request.FromDate">
                        <a class="btn btn-outline-primary" (click)="updateLeaveRequest(Request.LeaveRequestId)"
                          ><i class="ti ti-edit"></i
                        ></a>
                        <a class="btn btn-outline-danger m-2" (click)="deleteLeaveRequest(Request.LeaveRequestId)"
                          ><i class="ti ti-trash"></i
                        ></a>
                      </span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </ng-template>
  <ng-template ngbNavContent [ngIf]="activeSection == 'leavebalance'">
    <app-leavebalances></app-leavebalances>
  </ng-template>
  <div [ngbNavOutlet]="nav" class="mt-2"></div>
</div>
